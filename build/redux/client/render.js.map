{"version":3,"sources":["../../../source/redux/client/render.js"],"names":["render_on_client","history","devtools","create_page_element","routes","store","to","then","redirect","router_state","dispatch","router_element","create_route_element","should_scroll","component","element","result","process","env","NODE_ENV","window","devToolsExtension","DevTools","subsequent_render","previous_router_properties","new_router_properties","location","scroll","props","is_page_component","length","remount","_react_router_page_element_key","pathname","search","key","createElement"],"mappings":"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","file":"render.js","sourcesContent":["import React from 'react'\nimport { Router, applyRouterMiddleware } from 'react-router'\nimport { useScroll } from 'react-router-scroll'\n\nimport react_render_on_client from '../../render on client'\nimport { location_url } from '../../location'\nimport { redirect_action } from '../actions'\nimport match_routes_against_location from '../../react-router/match'\n\n// Renders the current page React element inside the `to` DOM element.\n//\n// Returns a `Promise` resolving to `{ store, component }`,\n// where `component` is the rendered React component\n// and `store` is the Redux store.\n//\nexport default function render_on_client({ history, devtools, create_page_element, routes, store, to })\n{\n\t// Performs `react-router` asynchronous match for current location\n\t// (is required for asynchonous routes to work).\n\treturn match_routes_against_location\n\t({\n\t\t// `react-router` `match()` internally uses this `history` to get current location.\n\t\t// Could have just used `document.location` here,\n\t\t// but what if, for example, `basename` feature of `history` is being used.\n\t\thistory,\n\t\troutes: typeof routes === 'function' ? routes(store) : routes\n\t})\n\t.then(({ redirect, router_state }) =>\n\t{\n\t\t// In case of a `react-router` `<Redirect/>`\n\t\tif (redirect)\n\t\t{\n\t\t\treturn store.dispatch(redirect_action(redirect))\n\t\t}\n\n\t\tconst router_element = <Router\n\t\t\t{ ...router_state }\n\t\t\tcreateElement={ create_route_element }\n\t\t\thistory={ history }\n\t\t\trender={ applyRouterMiddleware( useScroll(should_scroll) ) }/>\n\n\t\t// Wraps <Router/> with arbitrary React components (e.g. Redux <Provider/>),\n\t\t// loads internationalization messages,\n\t\t// and then renders the wrapped React page element to DOM\n\t\treturn create_page_element(router_element, { store }).then(element =>\n\t\t{\n\t\t\t// Render the wrapped React page element to DOM\n\t\t\tconst component = react_render_on_client\n\t\t\t({\n\t\t\t\telement, // wrapped React page element\n\t\t\t\tto // DOM element to which React markup will be rendered\n\t\t\t})\n\t\t\t.component\n\n\t\t\tconst result =\n\t\t\t{\n\t\t\t\tcomponent,\n\t\t\t\tstore\n\t\t\t}\n\n\t\t\t// If Redux-devtools aren't enabled, then just return the rendered page component\n\t\t\t// (if Redux-devtools are installed as a web browser extension\n\t\t\t//  then no need to do the second render pass too)\n\t\t\tif (process.env.NODE_ENV === 'production' || !devtools || window.devToolsExtension)\n\t\t\t{\n\t\t\t\treturn result\n\t\t\t}\n\n\t\t\t// Dev tools should be rendered after initial client render to prevent warning\n\t\t\t// \"React attempted to reuse markup in a container but the checksum was invalid\"\n\n\t\t\t// React JSX syntax can't detect lowercase elements\n\t\t\tconst DevTools = devtools.component\n\n\t\t\t// This element will contain\n\t\t\t// React page element and Redux-devtools.\n\t\t\t//\n\t\t\t// Since `DevTools` are inserted\n\t\t\t// outside of the `<Provider/>`,\n\t\t\t// provide the `store` manually.\n\t\t\t//\n\t\t\telement = \n\t\t\t(\n\t\t\t\t<div>\n\t\t\t\t\t{ element }\n\t\t\t\t\t<DevTools store={ store }/>\n\t\t\t\t</div>\n\t\t\t)\n\n\t\t\t// Render the wrapped React page element to DOM\n\t\t\tresult.component = react_render_on_client\n\t\t\t({\n\t\t\t\telement, // wrapped React page element\n\t\t\t\tto, // DOM element to which React markup will be rendered\n\t\t\t\tsubsequent_render: true // Prevents \"Server-side React render was discarded\" warning\n\t\t\t})\n\t\t\t.component\n\n\t\t\treturn result\n\t\t})\n\t})\n}\n\nfunction should_scroll(previous_router_properties, new_router_properties)\n{\n\tconst { location } = new_router_properties\n\n\tif (location.scroll === false)\n\t{\n\t\treturn false\n\t}\n\n\treturn true\n}\n\n// Fixes `react-router` bug by forcing \n// `<Route/>` `component` remount on any URL change.\n// https://github.com/ReactTraining/react-router/issues/1982\nfunction create_route_element(component, props)\n{\n\tconst { location, routes } = props\n\n\t// Is this the last React component in the route components chain\n\tconst is_page_component = component === routes[routes.length - 1].component\n\n\t// If it is then remount this page component\n\tif (is_page_component)\n\t{\n\t\t// Unless explicitly told not to remount\n\t\tif (location.remount !== false)\n\t\t{\n\t\t\twindow._react_router_page_element_key = `${location.pathname}${location.search}`\n\t\t}\n\n\t\t// Force `<Route/>` `component` remount on any URL change via `key` property.\n\t\tprops = { ...props, key: window._react_router_page_element_key }\n\t}\n\n\t// Default behaviour\n\treturn React.createElement(component, props)\n}"]}